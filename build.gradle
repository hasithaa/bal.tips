import groovy.json.JsonOutput

task verifyBallerinaVerision() {
    def stdout = new ByteArrayOutputStream()
    doLast {
        exec {
            commandLine "bash", "-c", "bal version  2>&1 | sed 1q"
            standardOutput = stdout;
        }
        def additionalData = [balVersion : stdout.toString()]
        file("data/ballerina.json").text = JsonOutput.toJson(additionalData)
    }
}

task test(dependsOn: [verifyBallerinaVerision]) {
}

task hugo() {
    def currentDir = file(".")
    def themeDir = file("themes/baltips")
    doLast {
        exec {
            commandLine "npm", "install"
            workingDir themeDir
        }
        exec {
            commandLine "npm", "run", "build"
            workingDir themeDir
        }
        exec {
            commandLine "hugo", "--minify"
            workingDir currentDir
        }
        String npm = 'npm';
        if (System.getProperty('os.name').toLowerCase().contains('windows')) {
            npm = 'npm.cmd'
        }
        exec {
            commandLine npm, 'run', 'buildsearch'
            workingDir currentDir
        }
    }
}


task codeGen() {
    doLast {
        exec {
            commandLine "bash", "-c", "node build-ballerina.js"
        }
    }
}

task prepare(dependsOn: [codeGen]){}